{% extends 'base.html' %}

{% load static %}

{% block title %} Cart {% endblock %}

{% block content %}
<style>
    .quantity-btn {
        border-radius: 20px;
        padding: 5px 10px;
        background-color: #007bff;
        color: #fff;
        border: none;
        cursor: pointer;
    }
    .card-body {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .card {
        margin-bottom: 20px;
    }
    .cart-item-row {
        margin-bottom: 20px;
    }
</style>

<!-- Shopping Cart -->
<div class="container">
<h2 class="mt-5 text-center">Shopping Cart</h2>

<div id="cartItems" class="row mt-4">
    <!-- Cart items will be displayed here -->
</div>
<div id="totalPrice" class="mt-4">
    <!-- Total price will be displayed here -->
</div>
</div>

<script>
// JavaScript code for managing the shopping cart
function displayCartItems() {
    let cartItems = JSON.parse(localStorage.getItem('cart')) || [];
    let cartItemsContainer = document.getElementById('cartItems');
    let totalPriceContainer = document.getElementById('totalPrice');
    cartItemsContainer.innerHTML = '';
    totalPriceContainer.innerHTML = '';

    if (cartItems.length === 0) {
        cartItemsContainer.innerHTML = '<p>Your cart is empty.</p>';
        return;
    }

    let totalPrice = 0;

    cartItems.forEach((item, index) => {
        let itemElement = document.createElement('div');
        itemElement.classList.add('col-lg-3', 'col-md-4', 'col-sm-6', 'cart-item-row');
        itemElement.innerHTML = `
            <div class="card mb-3">
                <div class="card-body">
                    <div>
                        <h5 class="card-title">${item.name}</h5>
                        <p class="card-text">$${item.price.toFixed(2)}</p>
                    </div>
                    <div>
                        <button class="quantity-btn" onclick="decreaseQuantity(${index})">-</button>
                        ${item.quantity > 1 ? `<span class="ml-1 mr-1">${item.quantity}</span>` : ''}
                        <button class="quantity-btn" onclick="increaseQuantity(${index})">+</button>
                        <button class="btn btn-danger ml-2" onclick="removeFromCart(${index})">Remove</button>
                    </div>
                </div>
            </div>
        `;
        cartItemsContainer.appendChild(itemElement);
        totalPrice += item.price * (item.quantity || 1);
    });

    totalPriceContainer.innerHTML = `<h4>Total: $${totalPrice.toFixed(2)}</h4>`;
}

function removeFromCart(index) {
    let cartItems = JSON.parse(localStorage.getItem('cart')) || [];
    cartItems.splice(index, 1);
    localStorage.setItem('cart', JSON.stringify(cartItems));
    displayCartItems();
}

function increaseQuantity(index) {
    let cartItems = JSON.parse(localStorage.getItem('cart')) || [];
    if (cartItems[index].quantity === undefined) {
        cartItems[index].quantity = 2;
    } else {
        cartItems[index].quantity += 1;
    }
    localStorage.setItem('cart', JSON.stringify(cartItems));
    displayCartItems();
}

function decreaseQuantity(index) {
    let cartItems = JSON.parse(localStorage.getItem('cart')) || [];
    if (cartItems[index].quantity === undefined || cartItems[index].quantity <= 1) {
        cartItems[index].quantity = 1;
    } else {
        cartItems[index].quantity -= 1;
    }
    localStorage.setItem('cart', JSON.stringify(cartItems));
    displayCartItems();
}

window.onload = displayCartItems;
</script>

{% endblock %}
